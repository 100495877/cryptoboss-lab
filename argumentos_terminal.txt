
-Guía de uso paso a paso 

-Paso 1: Inicializar la base de datos

bash
python -m chat_seguro.app --init-db --force
```

**Salida esperada:**
```
[DB] Inicializada en /Users/.../cryptoboss-lab/chat.db



-Paso 2: Crear la CA raíz 

bash
python -m chat_seguro.app pki-init-root
```

**Interacción:**
```
[PKI] Inicializando CA raíz...
Introduce contraseña para la CA raíz: ca123
Repite la contraseña: ca123
[PKI] Generando CA raíz...
[PKI] Guardando CA en base de datos...
[PKI] ✓ CA raíz creada:
      Subject: Chat Seguro Root CA
      Válido desde: 2025-11-13T...
      Válido hasta: 2035-11-11T...
      Serial: 123456789...
[OK] CA raíz inicializada correctamente.


-Paso 3: Registrar usuarios
Registrar a Alice:

bash
python -m chat_seguro.app register --user alice
```

**Interacción:**
```
Introduce una contraseña: alice123
Repite la contraseña: alice123
[KEYGEN] Generando par RSA 3072 bits…
[KEYSTORE] Cifrando clave privada con tu contraseña...
[OK] Usuario 'alice' registrado. Clave privada cifrada en BD.
[INFO] Usa 'pki-issue --user alice' para solicitar un certificado X.509.


Registrar a Bob:

bash
python -m chat_seguro.app register --user bob
```
```
Introduce una contraseña: bob456
Repite la contraseña: bob456
[KEYGEN] Generando par RSA 3072 bits…
[KEYSTORE] Cifrando clave privada con tu contraseña...
[OK] Usuario 'bob' registrado. Clave privada cifrada en BD.


-Paso 4: Emitir certificados X.509 
Certificado para Alice:

bash
python -m chat_seguro.app pki-issue --user alice
```

**Interacción:**
```
Contraseña de 'alice': alice123
Contraseña de la CA raíz: ca123
Email para 'alice' (opcional, Enter para omitir): alice@uc3m.es
[PKI] Generando CSR para 'alice'...
[PKI] Cargando CA raíz...
[PKI] Firmando certificado de 'alice'...
[PKI] Guardando certificado en base de datos...
[PKI] ✓ Certificado emitido para 'alice':
      Serial: 987654321...
      Válido hasta: 2026-11-13T...
[OK] Certificado emitido para 'alice'.



Certificado para Bob:

bash
python -m chat_seguro.app pki-issue --user bob
```
```
Contraseña de 'bob': bob456
Contraseña de la CA raíz: ca123
Email para 'bob' (opcional, Enter para omitir): [Enter]
[PKI] ✓ Certificado emitido para 'bob'...


-Paso 5: Alice envía un mensaje cifrado a Bob

bash
python -m chat_seguro.app send --to bob --message "Hola Bob! Este es un mensaje super secreto"
```

**Interacción:**
```
Tu usuario (emisor): alice
Tu contraseña: alice123
[OK] Mensaje cifrado y firmado enviado a 'bob'.

qué pasó?:
1. Se cifró el mensaje con AES-256-GCM
2. Se cifró la clave de sesión con RSA-OAEP (usando la clave pública de Bob)
3. Se firmó el paquete completo con RSA-PSS (clave privada de Alice)
4. Todo se guardó en la base de datos



-Paso 6: Bob revisa su bandeja de entrada

bash
python -m chat_seguro.app inbox
```

**Interacción:**
```
Usuario (destinatario): bob
[INBOX] Mensajes para 'bob':
  - id=1  de=alice  fecha=2025-11-13 15:30:42


-Paso 7: Bob lee el mensaje (VERIFICA FIRMA Y CERTIFICADO)

bash
python -m chat_seguro.app read --id 1
```

**Interacción:**
```
Tu usuario (destinatario): bob
Tu contraseña: bob456
[OK] ✓ Firma verificada correctamente.
Contraseña de la CA (para verificar): ca123
[OK] ✓ Certificado del emisor válido.

----- MENSAJE -----
Hola Bob! Este es un mensaje super secreto 
-------------------
Antes de mostrar el mensaje, se verifica:
1. ✓ Firma digital RSA-PSS (autenticidad e integridad)
2. ✓ Certificado X.509 (que Alice realmente es Alice)
3. ✓ Descifrado AES-GCM (confidencialidad)


-Paso 8: Bob responde a Alice

bash
python -m chat_seguro.app send --to alice --message "Recibido, Alice! Todo perfecto"
```
```
Tu usuario (emisor): bob
Tu contraseña: bob456
[OK] Mensaje cifrado y firmado enviado a 'alice'.


-Paso 9: Alice lee la respuesta

bash
# Ver bandeja
python -m chat_seguro.app inbox
```
```
Usuario (destinatario): alice
[INBOX] Mensajes para 'alice':
  - id=2  de=bob  fecha=2025-11-13 15:32:15


bash
# Leer mensaje
python -m chat_seguro.app read --id 2
```
```
Tu usuario (destinatario): alice
Tu contraseña: alice123
[OK] ✓ Firma verificada correctamente.
Contraseña de la CA (para verificar): ca123
[OK] ✓ Certificado del emisor válido.

----- MENSAJE -----
Recibido, Alice! Todo perfecto 
-------------------
